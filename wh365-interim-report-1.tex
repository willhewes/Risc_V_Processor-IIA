\documentclass[a4paper,10pt]{article}
% Use ctrl + alt + V to view live pdf

% Packages
\usepackage[utf8]{inputenc} % For encoding
\usepackage[T1]{fontenc} % Better handling of accented characters and hyphenation
\usepackage{microtype} % Improves spacing and justification
\usepackage{amsmath, amssymb} % For equations and symbols
\usepackage{graphicx} % For including graphics/images
\usepackage{caption} % For customizing figure and table captions
\usepackage{subcaption} % For subfigures and subcaptions
\usepackage{float} % For fixing figure and table positions
\usepackage{booktabs} % For professional-looking tables
\usepackage{siunitx} % For consistent typesetting of units and numbers
\usepackage[margin=2cm]{geometry} % Adjusts page margins
\usepackage{fancyhdr} % For custom headers and footers
\usepackage{lmodern} % For a professional-looking font (main body font)
\usepackage{titlesec} % For title customization
\usepackage{array} % For custom table formatting
\usepackage[colorlinks=true, linkcolor=black, urlcolor=black]{hyperref} % Colored links without boxes
\usepackage{cleveref} % For improved cross-referencing    
\usepackage{multirow}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{textcomp}
\usepackage{tabularx}
\usepackage{array}
\usepackage{changepage}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows}
\newcolumntype{Y}{>{\centering\arraybackslash}X}


\lstdefinestyle{vhdl-style}{
    language=VHDL,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\bfseries\color{blue},
    commentstyle=\itshape\color{gray},
    stringstyle=\color{red},
    numbers=left,
    numberstyle=\tiny\color{gray},
    stepnumber=1,
    breaklines=true,
    showstringspaces=false,
    frame=single
}
\lstset{style=vhdl-style}
\lstset{captionpos=b}
\lstset{basicstyle=\ttfamily\scriptsize} 
\renewcommand{\lstlistingname}{Program}

% Custom settings
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\textit{GB3 - Risc-V Processor}} % Header left
\fancyhead[R]{\textit{Will Hewes - wh365}} % Header right 
\fancyfoot[C]{\thepage} % Footer center
\setlength{\headheight}{15pt} % Header height
\setlength{\parindent}{0em} % Indentation for paragraphs
\setlength{\parskip}{0.2em} % Add spacing between paragraphs
\setlength{\abovedisplayskip}{0.5em}
\setlength{\belowdisplayskip}{0.5em}
\setlength{\abovedisplayshortskip}{0.5em}
\setlength{\belowdisplayshortskip}{0.5em}
% \setlist{topsep=0em, partopsep=0em, itemsep=0em, parsep=0em}

\graphicspath{{C:/Users/willi/My Drive/Engineering/Obsidian Vault/Uni/Lab Reports/3B2/FTR/Images}}

% \renewcommand{\arraystretch}{1.2}

% Title formatting
\renewcommand{\maketitle}{
    \begin{center}
        \LARGE \textbf{ENGINEERING TRIPOS PART IIA} \\ 
        \vspace{0.5em}
        \Large \textbf{GB3 - Risc-V Processor} \\ 
        \vspace{0.5em}
        \textbf{First Interim Report} \\
        \large Group 4 - Resource Usage \\
        \vspace{1em}
        \large Will Hewes - wh365 \\ 
        Pembroke College \\ 
        \vspace{0.5em}
    \end{center}
}

\begin{document}
\maketitle
\hrule
\tableofcontents
\newpage

\section{Introduction}
\label{sec:Introduction}
% This section should give a quick overview of the teamâ€™s task as a whole

This project involves the collaborative design and implementation 
of a RISC-V processor on an iCE40 FPGA platform. 
The overarching aim is to optimise 
the processor design with respect to its 
performance, power dissipation, and resource usage, 
while balancing trade-offs between these three aspects. 
Each team member is responsible for focusing on one of the three aspects.
This report will focus on the resource usage of the design.

This interim report characterises the baseline design. 
We are evaluating three provided example programs - 
\texttt{hardwareblink}, \texttt{softwareblink}, and \texttt{bubblesort} - 
to establish benchmarks for the logic usage, power dissipation and timing. 
These programs exercise the processor and surrounding hardware to varying degrees, 
and provide a foundation against which future design improvements can be compared.


\section{Project Specification}
\label{sec:Project_Specification}
%This section should provide an overview of your specific
%task as part of the team.

Within the team, my specific task focuses on 
optimising the resource usage of the FPGA implementation. 
The goal of this optimisation is to reduce the number of 
Look-Up Tables (LUTs), flip-flops, and wires used in the design. 
This allows more headroom on the device for future expansions 
and increases the scalability of the design.


\iffalse
LUTs, flip-flops, and routing wires are 
the fundamental building blocks of digital logic in an FPGA. 
A LUT is a configurable logic element that can implement 
arbitrary combinational logic functions 
by storing precomputed outputs for each possible input combination. 
Flip-flops are used to store single bits of state and 
are essential for implementing sequential logic, 
such as registers and control signals. 
Routing wires connect LUTs and flip-flops together, 
allowing signals to propagate through the design. 
The quantity and efficiency of these elements directly impact 
how much logic the FPGA can implement and how complex the system can be.
\fi

For this interim report, the goal is not to 
change the programs or optimise the device yet.
This report only characterises the resource usage of the three programs.


\section{Summary of Preliminary Design Work}
\label{sec:Summary_of_Preliminary_Design_Work}

To assess the resource usage of each of the three programs, 
the designs were synthesised using \texttt{yosys} 
and place-and-route was performed using \texttt{nextpnr}. 

\subsection{Hardwareblink}
\label{sec:Hardwareblink}

The first program evaluated was \texttt{hardwareblink}.
This example does not use the RISC-V processor core and 
instead relies purely on combinational and sequential logic defined in Verilog.

This program implements a simple hardware-only design that 
toggles \textit{LED D14} at 1\,Hz using a counter. 
In order to toggle the LED at 1\,Hz, 
\texttt{hardwareblink} makes use of the 48\,MHz \textit{HFOSC},
and divides it by 24,000,000 in a counter.
This output toggles a register, 
the value of which is mapped to pin \textit{D3} (driving \textit{LED D14}),
giving rise to a 1\,Hz blinking light.

The summary of the resulting logic utilisation is shown
in Table \ref{tab:hardware_yosys_report} below.

\begin{table}[H]
    \centering
    \begin{tabular}{|l|c|}
        \hline
        \textbf{Primitive} & \textbf{Count} \\
        \hline
        \texttt{SB\_LUT4} logic cells (combinational) & 65 \\
        \texttt{SB\_DFF} flip-flops & 0 \\
        \texttt{SB\_DFFE} flip-flops with clock enable & 1 \\
        \texttt{SB\_DFFSR} flip-flops with set/reset & 32 \\
        \texttt{SB\_DFFSS} flip-flops with set/set & 0 \\
        \texttt{SB\_CARRY} carry-chain elements & 61 \\
        \texttt{SB\_RAM40\_4K} block RAMs & 0 \\
        \texttt{SB\_HFOSC} internal oscillator & 1 \\
        \hline
    \end{tabular}
    \caption{Primitive cell usage reported by \texttt{yosys} for the \texttt{hardwareblink} design}
    \label{tab:hardware_yosys_report}
\end{table}



Corresponding to 160 cells in total.

Subsequently, \texttt{nextpnr} was used to place and route these logic cells,
with the results shown in Table \ref{tab:hardware_pnr_report}.

\begin{table}[H]
    \centering
    \begin{tabularx}{0.7\textwidth}{X c c}
        \toprule
        Resource type & Used & \% of UP5K total \\ \midrule
        Logic cells (\texttt{ICESTORM\_LC}) & 103 / 5\,280 & 1.9\,\% \\
        Block RAMs (\texttt{ICESTORM\_RAM}) & 0 / 30 & 0\,\% \\
        IO buffers (\texttt{SB\_IO}) & 1 / 96 & 1.0\,\% \\
        Global buffers (\texttt{SB\_GB}) & 2 / 8  & 25\,\% \\
        HF oscillators (\texttt{SB\_HFOSC}) & 1 / 1  & 100\,\% \\ 
    \bottomrule
    \end{tabularx}
    \caption{Place-and-route logic utilisation reported by 
    \texttt{nextpnr} for \texttt{hardwareblink}}
    \label{tab:hardware_pnr_report}
\end{table}

This report shows that only 103 logic cells were used on the FPGA fabric, 
corresponding to approximately 2\% of the available 5280 logic cells 
on the iCE40 UP5K device.


No block RAMs, memories, or processor logic were involved in this design, 
making it a minimal baseline for comparison. 
The low utilisation confirms the simplicity of the circuit 
and provides a reference point for understanding 
how resource usage increases with more complex processor-driven programs.


\subsection{Softwareblink}
\label{sec:Softwareblink}

The second program evaluated was \texttt{softwareblink}. 
In contrast to \texttt{hardwareblink}, 
this design makes use of the full RISC-V processor core 
to execute a compiled C program that toggles \textit{LED D14} in software. 
The program operates by writing to a memory-mapped I/O register at regular intervals, 
with timing determined by a simple delay loop. 
This introduces a significant increase in logic complexity, 
as instruction decoding, arithmetic, control logic, and memory access logic 
are all active.

To synthesise this design, \texttt{softwareblink.c} was compiled 
using the RISC-V GCC toolchain into \texttt{program.hex} and \texttt{data.hex}, 
which were then loaded into the processor design 
before synthesis using \texttt{yosys} and place-and-route using \texttt{nextpnr}.

Table \ref{tab:software_yosys_report} shows the breakdown of primitive cell usage 
as reported by \texttt{yosys} after synthesis.

\begin{table}[H]
    \centering
    \begin{tabular}{|l|c|}
        \hline
        \textbf{Primitive} & \textbf{Count} \\
        \hline
        \texttt{SB\_LUT4} logic cells (combinational) & 1\,965 \\
        \texttt{SB\_DFF} flip-flops & 415 \\
        \texttt{SB\_DFFE} flip-flops with clock enable & 154 \\
        \texttt{SB\_DFFSR} flip-flops with set/reset & 100 \\
        \texttt{SB\_DFFSS} flip-flops with set/set & 4 \\
        \texttt{SB\_CARRY} carry-chain elements & 216 \\
        \texttt{SB\_RAM40\_4K} block RAMs & 20 \\
        \texttt{SB\_HFOSC} internal oscillator & 1 \\
        \hline
    \end{tabular}
    \caption{Primitive cell usage reported by \texttt{yosys} for the \texttt{softwareblink} processor design}
    \label{tab:software_yosys_report}
\end{table}

Table \ref{tab:software_pnr_report} shows the corresponding logic usage 
on the FPGA fabric as reported by \texttt{nextpnr}. 
This design consumes 50\% of the device's logic cell resources 
and two-thirds of its available block RAMs, 
representing a substantial increase in resource usage 
relative to \texttt{hardwareblink}.

\begin{table}[H]
    \centering
    \begin{tabularx}{0.7\textwidth}{X c c}
        \toprule
        Resource type & Used & \% of UP5K total \\ \midrule
        Logic cells (\texttt{ICESTORM\_LC}) & 2662 / 5280 & 50\,\% \\
        Block RAMs (\texttt{ICESTORM\_RAM})& 20 / 30 & 66\,\% \\
        IO buffers (\texttt{SB\_IO}) & 8 / 96 & 8\,\% \\
        Global buffers (\texttt{SB\_GB}) & 5 / 8 & 62\,\% \\
        HF oscillators (\texttt{ICESTORM\_HFOSC}) & 1 / 1 & 100\,\% \\
        \bottomrule
    \end{tabularx}
    \caption{Place-and-route logic utilisation reported by 
    \texttt{nextpnr} for \texttt{softwareblink}}
    \label{tab:software_pnr_report}
\end{table}

This evaluation establishes the baseline resource cost 
of running programs on the processor. 
The increased logic and memory usage, relative to \texttt{hardwareblink}, 
reflect the added complexity of 
instruction decoding, pipeline control, and memory access. 
These results provide a benchmark for future optimisations 
aimed at reducing the resource footprint of the processor.

\subsection{Bubblesort}
\label{sec:Bubblesort}

\section{Conclusion and Future Work}
\label{sec:Conclusion_and_Future_Work}

\appendix
\section{Appendix}
%Use this section to include diagrams, Verilog or C code, etc

\end{document}